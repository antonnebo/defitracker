<%
  # Local variables expected:
  # - positions: Array of position hashes
  # - title: String ("Supplied" or "Borrowed")
  # - is_debt: Boolean (true for borrowed section)
  # - is_multichain: Boolean (show chain column if true)
%>

<div style="<%= 'margin-top: 24px;' if title == 'Borrowed' %>">
  <!-- Section Header -->
  <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid <%= is_debt ? 'rgba(239, 68, 68, 0.3)' : 'var(--color-border)' %>;">
    <div style="display: flex; align-items: center; gap: 8px;">
      <h3 style="font-size: 0.875rem; font-weight: 600; color: <%= is_debt ? '#EF4444' : 'var(--color-text-secondary)' %>; text-transform: uppercase; letter-spacing: 0.05em; margin: 0;">
        <%= title %>
      </h3>
      <span style="font-size: 0.75rem; color: var(--color-text-tertiary);">
        (<%= positions.length %>)
      </span>
    </div>
    <% if is_debt %>
      <div style="font-size: 0.875rem; font-weight: 600; font-family: var(--font-display); color: #EF4444;">
        -$<%= number_with_delimiter(positions.sum { |p| p["usd_value"].to_f.abs }.round(2), delimiter: ",") %>
      </div>
    <% end %>
  </div>

  <!-- Positions Grid -->
  <div style="display: grid; gap: 8px;">
    <% positions.each do |position| %>
      <div style="display: grid; grid-template-columns: <%= is_multichain ? '2fr 1fr 1fr 100px' : '2fr 1fr 1fr' %>; gap: 16px; align-items: center; padding: 12px 16px; background: <%= is_debt ? 'rgba(239, 68, 68, 0.03)' : 'var(--color-bg-elevated)' %>; border: 1px solid <%= is_debt ? 'rgba(239, 68, 68, 0.2)' : 'var(--color-border)' %>; border-radius: var(--radius-sm);">

        <!-- Asset Column -->
        <div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <span style="font-weight: 600; color: var(--color-text-primary); font-size: 0.9375rem;">
              <%= position["token_symbol"] %>
            </span>
            <% if is_debt %>
              <span style="display: inline-flex; align-items: center; padding: 2px 6px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-sm); font-size: 0.75rem; color: #EF4444; font-weight: 600;">
                DEBT
              </span>
            <% end %>
          </div>
          <p style="font-size: 0.8125rem; color: var(--color-text-secondary); margin: 4px 0 0 0;">
            <%= position["token_name"] %>
          </p>
        </div>

        <!-- Balance Column -->
        <div style="text-align: right;">
          <p style="font-weight: 600; color: <%= is_debt ? '#EF4444' : 'var(--color-text-primary)' %>; font-size: 0.9375rem; margin: 0;">
            <%= number_with_delimiter(position["balance"].to_f.abs.round(6), delimiter: ",") %>
          </p>
        </div>

        <!-- USD Value Column -->
        <div style="text-align: right;">
          <p style="font-weight: 700; font-family: var(--font-display); font-size: 0.9375rem; color: <%= is_debt ? '#EF4444' : 'var(--color-text-primary)' %>; margin: 0;">
            <% if is_debt %>
              -$<%= number_with_delimiter(position["usd_value"].to_f.abs.round(2), delimiter: ",") %>
            <% else %>
              $<%= number_with_delimiter(position["usd_value"].to_f.round(2), delimiter: ",") %>
            <% end %>
          </p>
        </div>

        <!-- Chain Column (if multichain) -->
        <% if is_multichain %>
          <div style="text-align: right;">
            <span style="font-size: 0.75rem; color: var(--color-text-tertiary); text-transform: uppercase; background: var(--color-bg-secondary); padding: 4px 8px; border-radius: var(--radius-sm); border: 1px solid var(--color-border); display: inline-block;">
              <%= position["chain"] %>
            </span>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
